---
# -------------------------------
# Node.js (system-wide)
# -------------------------------
- name: Add NodeSource GPG key
  ansible.builtin.shell: |
    curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key \
    | gpg --dearmor -o /usr/share/keyrings/nodesource.gpg
  args:
    creates: /usr/share/keyrings/nodesource.gpg
    executable: /bin/bash
  become: true

- name: Add NodeSource Node.js {{ node_major_version }} repo
  ansible.builtin.apt_repository:
    repo: "deb [signed-by=/usr/share/keyrings/nodesource.gpg] https://deb.nodesource.com/node_{{ node_major_version }}.x nodistro main"
    state: present
    filename: nodesource
  become: true

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: yes
  become: true



- name: Install Node.js
  ansible.builtin.apt:
    name: nodejs
    state: present
  become: true

# -------------------------------
# pnpm (corepack â€“ safest way)
# -------------------------------
- name: Enable corepack
  ansible.builtin.command: corepack enable
  args:
    creates: /usr/local/bin/pnpm
  become: true

- name: Prepare pnpm version
  ansible.builtin.command: corepack prepare pnpm@{{ pnpm_version }} --activate
  become: true
